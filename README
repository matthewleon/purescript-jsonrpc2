WIP

TODO: make batches generic
TODO: test against schema
